# Legnext Midjourney API - Simplified Caddy Configuration

legnext.ai, www.legnext.ai {
    # Redirect www to non-www
    @www host www.legnext.ai
    redir @www https://legnext.ai{uri} permanent

    # Security headers
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        X-XSS-Protection "1; mode=block"
        -Server
        -X-Powered-By
    }

    # Static files caching
    @static path /_next/static/* /favicon.ico *.css *.js *.woff *.woff2
    handle @static {
        header Cache-Control "public, max-age=31536000, immutable"
        reverse_proxy localhost:3000
    }

    @images path *.jpg *.jpeg *.png *.gif *.ico *.svg *.webp
    handle @images {
        header Cache-Control "public, max-age=2592000"
        reverse_proxy localhost:3000
    }

    # Rate limiting for auth routes
    handle /api/auth/* {
        reverse_proxy localhost:3000 {
            header_up X-Forwarded-Proto {scheme}
            header_up X-Real-IP {remote}
        }
    }

    # All other routes
    handle {
        reverse_proxy localhost:3000 {
            header_up X-Forwarded-Proto {scheme}
            header_up X-Real-IP {remote}
        }
    }

    # Compression and logging
    encode gzip
    log
}
